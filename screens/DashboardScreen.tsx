import React, { useState } from 'react';
import {
        View,
        Text,
        StyleSheet,
        SafeAreaView,
        TouchableOpacity,
        Image,
        ScrollView,
} from 'react-native';
import { Ionicons } from '@expo/vector-icons';

const DashboardScreen = ({ navigation }) => {
        const [expandedSections, setExpandedSections] = useState({
                village: false,
                division: false
        });
        const [selectedVillage, setSelectedVillage] = useState(null);
        const [selectedBhag, setSelectedBhag] = useState(null);
        const [selectedVibhag, setSelectedVibhag] = useState(null);

        // Enhanced village data structure with voter details
        const villageData = {
                'दारुंब्रे': {
                        'भाग - ३८७': {
                                'गाढवाण दारुंब्रे': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "",
                                        "विधान_क्रमांक": "",
                                        "वार्ड_भाग_क्रमांक": "387",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'खडकवस्ती दारुंब्रे': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "",
                                        "विधान_क्रमांक": "",
                                        "वार्ड_भाग_क्रमांक": "387",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'बाभळी बस्ती दारुंब्रे': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "",
                                        "विधान_क्रमांक": "",
                                        "वार्ड_भाग_क्रमांक": "387",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'लोखंडवस्ती दारुंब्रे': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "",
                                        "विधान_क्रमांक": "",
                                        "वार्ड_भाग_क्रमांक": "387",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                }
                        }
                },
                'इंदुरी': {
                        'भाग - २२३': {
                                'इंदुरी गारखान इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "1-गावडाला_हुंडी",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [
                                                {
                                                        "क्रमांक": 1,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7736622",
                                                        "नाव": "श्री सर्वेश सुधीर आत्मानंद",
                                                        "पिता_नाव": "सुधीर",
                                                        "वय": "28 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 2,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8175150",
                                                        "नाव": "श्रीमती मंजिरा सर्वेश आत्मा",
                                                        "पती_नाव": "सर्वेश",
                                                        "वय": "38 वर्ष",
                                                        "लिंग": "महिला",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 3,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8019960",
                                                        "नाव": "श्री विजयकुमार भीमराव आत्मे",
                                                        "पिता_नाव": "भीमराव",
                                                        "वय": "34 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 4,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8175077",
                                                        "नाव": "श्री आत्माराम रावसाहेब आत्मा",
                                                        "पिता_नाव": "रावसाहेब",
                                                        "वय": "26 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 5,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434715",
                                                        "नाव": "श्रीमती अनुसार विजय आत्मेंद्र",
                                                        "पती_नाव": "विजय",
                                                        "वय": "46 वर्ष",
                                                        "लिंग": "महिला",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 6,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434814",
                                                        "नाव": "श्री अनिल सुभाष आत्मेंद्र",
                                                        "पिता_नाव": "सुभाष",
                                                        "वय": "39 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 7,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8175192",
                                                        "नाव": "श्री देवानंद भास्करराव भानगड",
                                                        "पिता_नाव": "भास्करराव",
                                                        "वय": "36 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 8,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8291437",
                                                        "नाव": "श्री पुरुषोत्तम मदकुमार भानगड",
                                                        "पिता_नाव": "मदकुमार",
                                                        "वय": "30 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 9,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8175085",
                                                        "नाव": "श्री सुनील नानूराव भानगड",
                                                        "पिता_नाव": "नानूराव",
                                                        "वय": "27 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 10,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7635337",
                                                        "नाव": "श्री संजयकुमार तुकाराम भारतीय",
                                                        "पिता_नाव": "तुकाराम",
                                                        "वय": "31 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 11,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7981954",
                                                        "नाव": "श्रीमती किरण सुभाष भारतीय",
                                                        "पती_नाव": "सुभाष",
                                                        "वय": "26 वर्ष",
                                                        "लिंग": "महिला",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 12,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7981871",
                                                        "नाव": "श्री किशोर विकास काणे",
                                                        "पिता_नाव": "विकास",
                                                        "वय": "35 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 13,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7635295",
                                                        "नाव": "श्री अनंत वसंतराव भारतीय",
                                                        "पिता_नाव": "वसंतराव",
                                                        "वय": "30 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 14,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7635212",
                                                        "नाव": "श्री संतोष प्रविण भोसले",
                                                        "पिता_नाव": "प्रविण",
                                                        "वय": "34 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 15,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7981889",
                                                        "नाव": "श्री सुनील नारायण भोसले",
                                                        "पिता_नाव": "नारायण",
                                                        "वय": "40 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 16,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7981905",
                                                        "नाव": "श्री रामलाल विठ्ठल बनेकर",
                                                        "पिता_नाव": "विठ्ठल",
                                                        "वय": "34 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 17,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434848",
                                                        "नाव": "श्रीमती सुनीता मंदीर पडकन",
                                                        "पती_नाव": "मंदीर",
                                                        "वय": "40 वर्ष",
                                                        "लिंग": "महिला",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 18,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8247991",
                                                        "नाव": "श्री किशोर विकास दरडे",
                                                        "पिता_नाव": "विकास",
                                                        "वय": "44 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 19,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7922834",
                                                        "नाव": "श्री जगदीशराव किसनराव दरडे",
                                                        "पिता_नाव": "किसनराव",
                                                        "वय": "36 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 20,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434699",
                                                        "नाव": "श्री सुजल चंद्रशेखर धरे",
                                                        "पिता_नाव": "चंद्रशेखर",
                                                        "वय": "33 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 21,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7280746",
                                                        "नाव": "श्री सोनिका चंद्रिका धरे",
                                                        "पिता_नाव": "चंद्रिका",
                                                        "वय": "32 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 22,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7280738",
                                                        "नाव": "श्री गजानन्द पाटील धरे",
                                                        "पिता_नाव": "पाटील",
                                                        "वय": "30 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 23,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8248049",
                                                        "नाव": "श्रीमती सुजाता चंद्रिका धरे",
                                                        "पती_नाव": "चंद्रिका",
                                                        "वय": "27 वर्ष",
                                                        "लिंग": "महिला",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 24,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8248056",
                                                        "नाव": "श्री मोहनराव पाटील धरे",
                                                        "पिता_नाव": "पाटील",
                                                        "वय": "25 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 25,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8175127",
                                                        "नाव": "श्री पवन गणपतराव धरे",
                                                        "पिता_नाव": "गणपतराव",
                                                        "वय": "25 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 26,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8019937",
                                                        "नाव": "श्री सुधीर उदयभान गाडेकर",
                                                        "पिता_नाव": "उदयभान",
                                                        "वय": "43 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 27,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434772",
                                                        "नाव": "श्री कृष्णारामजी आनंदराव गाडेकर",
                                                        "पिता_नाव": "आनंदराव",
                                                        "वय": "59 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 28,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434830",
                                                        "नाव": "श्री संतु विठ्ठल गाडेकर",
                                                        "पिता_नाव": "विठ्ठल",
                                                        "वय": "55 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 29,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7635303",
                                                        "नाव": "श्री सुजाता संतु गाडेकर",
                                                        "पिता_नाव": "संतु",
                                                        "वय": "38 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                },
                                                {
                                                        "क्रमांक": 30,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM7434624",
                                                        "नाव": "श्री किशोर कृष्णारामजी गाडेकर",
                                                        "पिता_नाव": "कृष्णारामजी",
                                                        "वय": "30 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                }
                                        ],
                                        "दिनांक": "01-10-2024",
                                        "पृष्ठ": "40 - पृष्ठ 3"
                                },
                                'इंदुरी बाजारपट्टे इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "2-बाजारपट्टा",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [
                                                {
                                                        "क्रमांक": 1,
                                                        "मतदार_ओळखपत्र_क्रमांक": "UXM8291437",
                                                        "नाव": "श्री दिलीप गंगाराम भागवत",
                                                        "पिता_पती_नाव": "गंगाराम दिलीप गंगाराम भागवत",
                                                        "घर_क्रमांक": "",
                                                        "वय": "30 वर्ष",
                                                        "लिंग": "पुरुष",
                                                        "स्लिप जारी केली": false,
                                                        "मतदान झाले": false
                                                }
                                        ],
                                        "दिनांक": "01-10-2024",
                                        "पृष्ठ": "40 - पृष्ठ 4"
                                },
                                'खारिआ वाडा इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "3-खारिआ_वाडा",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'इंदुरी बाजारपट्टे माळी भाग इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "4-माळी_भाग",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'सिद्दिविनायक माळी भाग इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "5-सिद्दिविनायक",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'विष्णु मंदिर इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "6-विष्णु_मंदिर",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'पवारवाडा इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "7-पवारवाडा",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'खारिआ म्हसा इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "8-खारिआ_म्हसा",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'खारिआ विर्व बस्ती इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "9-विर्व_बस्ती",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'रावसाहेब विर्व बस्ती इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "10-रावसाहेब_बस्ती",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'गारखान इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "11-गारखान",
                                        "वार्ड_भाग_क्रमांक": "223",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                }
                        },
                        'भाग - २२४': {
                                'गारखान इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "1-गारखान",
                                        "वार्ड_भाग_क्रमांक": "224",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'तुकार बस्ती गारखान इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "2-तुकार_बस्ती",
                                        "वार्ड_भाग_क्रमांक": "224",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'गारखानजवळ बाळा गारखान इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "3-बाळा_गारखान",
                                        "वार्ड_भाग_क्रमांक": "224",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                },
                                'बेंडबवी बस्ती इंदुरी': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "204-मालकापूर",
                                        "विधान_क्रमांक": "4-बेंडबवी_बस्ती",
                                        "वार्ड_भाग_क्रमांक": "224",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                }
                        },
                        'भाग - २२५': {}
                },
                'जांबवडे': {
                        'भाग - १९९': {
                                'सुधूर्ण गावठाण जांबवडे': {
                                        "विधानसभा_मतदारसंघ_क्रमांक": "",
                                        "विधान_क्रमांक": "",
                                        "वार्ड_भाग_क्रमांक": "199",
                                        "मतदार_यादी": [],
                                        "दिनांक": "",
                                        "पृष्ठ": ""
                                }
                        }
                },
                'मालवाडी': {
                        'भाग - १९०': {},
                        'भाग - १९१': {}
                },
                'नवलाख उंब्रे': {
                        'भाग - ११८': {}
                },
                'साळुंब्रे': {
                        'भाग - ३८३': {}
                },
                'शिरगाव': {
                        'भाग - ३५१': {}
                },
                'सुदुंब्रे': {
                        'भाग - २००': {}
                }
        };

        const toggleSection = (section) => {
                setExpandedSections(prev => ({
                        ...prev,
                        [section]: !prev[section]
                }));
        };

        const handleVillageSelect = (village) => {
                setSelectedVillage(village);
                setSelectedBhag(null);
                setSelectedVibhag(null);

                const bhags = Object.keys(villageData[village]);
                if (bhags.length === 1) {
                        setSelectedBhag(bhags[0]);
                        setExpandedSections({
                                village: false,
                                division: true
                        });
                } else {
                        setExpandedSections({
                                village: false,
                                division: false
                        });
                }
        };

        const handleBhagSelect = (bhag) => {
                setSelectedBhag(bhag);
                setSelectedVibhag(null);
                setExpandedSections({
                        village: false,
                        division: false
                });
        };

        const handleVibhagSelect = (vibhag) => {
                setSelectedVibhag(vibhag);
        };

        const handleSubmit = () => {
                if (selectedVillage && selectedBhag && selectedVibhag) {
                        const vibhagData = villageData[selectedVillage][selectedBhag][selectedVibhag];
                        navigation.navigate('VoterSearch', {
                                village: selectedVillage,
                                division: selectedBhag,  // Using 'division' as the parameter name to match MemberSearchScreen
                                vibhag: selectedVibhag,
                                voters: vibhagData.मतदार_यादी,  // Fixed the property name here
                                metadata: {
                                        विधानसभा_मतदारसंघ_क्रमांक: vibhagData.विधानसभा_मतदारसंघ_क्रमांक,
                                        विधान_क्रमांक: vibhagData.विधान_क्रमांक,
                                        वार्ड_भाग_क्रमांक: vibhagData.वार्ड_भाग_क्रमांक,
                                        दिनांक: vibhagData.दिनांक,
                                        पृष्ठ: vibhagData.पृष्ठ
                                }
                        });
                }
        };

        const hasMultipleBhags = selectedVillage && Object.keys(villageData[selectedVillage]).length > 1;
        const hasVibhags = selectedBhag && selectedVillage &&
                villageData[selectedVillage][selectedBhag] &&
                Object.keys(villageData[selectedVillage][selectedBhag]).length > 0;

        return (
                <SafeAreaView style={styles.container}>
                        {/* Header and profile section remains same */}

                        {/* Village Dropdown */}
                        <View style={[styles.expandableSection, { marginTop: 20 }]}>
                                <TouchableOpacity
                                        style={styles.expandableHeader}
                                        onPress={() => toggleSection('village')}
                                >
                                        <Text style={styles.expandableTitle}>
                                                {selectedVillage ? selectedVillage : 'गाव निवडा'}
                                        </Text>
                                        <Ionicons
                                                name={expandedSections.village ? 'chevron-up' : 'chevron-down'}
                                                size={20}
                                                color="#000"
                                        />
                                </TouchableOpacity>

                                {expandedSections.village && (
                                        <View style={styles.dropdownContent}>
                                                {Object.keys(villageData).map((village) => (
                                                        <TouchableOpacity
                                                                key={village}
                                                                style={styles.dropdownItem}
                                                                onPress={() => handleVillageSelect(village)}
                                                        >
                                                                <Text>{village}</Text>
                                                        </TouchableOpacity>
                                                ))}
                                        </View>
                                )}
                        </View>

                        {/* Bhag Dropdown - Only shown if village has multiple bhags */}
                        {hasMultipleBhags && selectedVillage && (
                                <View style={styles.expandableSection}>
                                        <TouchableOpacity
                                                style={styles.expandableHeader}
                                                onPress={() => toggleSection('division')}
                                        >
                                                <Text style={styles.expandableTitle}>
                                                        {selectedBhag ? selectedBhag : 'भाग निवडा'}
                                                </Text>
                                                <Ionicons
                                                        name={expandedSections.division ? 'chevron-up' : 'chevron-down'}
                                                        size={20}
                                                        color="#000"
                                                />
                                        </TouchableOpacity>

                                        {expandedSections.division && (
                                                <View style={styles.dropdownContent}>
                                                        {Object.keys(villageData[selectedVillage]).map((bhag) => (
                                                                <TouchableOpacity
                                                                        key={bhag}
                                                                        style={styles.dropdownItem}
                                                                        onPress={() => handleBhagSelect(bhag)}
                                                                >
                                                                        <Text>{bhag}</Text>
                                                                </TouchableOpacity>
                                                        ))}
                                                </View>
                                        )}
                                </View>
                        )}

                        {/* Vibhag Selection - Only shown if bhag is selected and has vibhags */}
                        {hasVibhags && (
                                <View style={styles.expandableSection}>
                                        <Text style={styles.vibhagLabel}>विभाग निवडा:</Text>
                                        {Object.keys(villageData[selectedVillage][selectedBhag]).map((vibhag) => (
                                                <TouchableOpacity
                                                        key={vibhag}
                                                        style={[
                                                                styles.vibhagItem,
                                                                selectedVibhag === vibhag && styles.vibhagItemSelected
                                                        ]}
                                                        onPress={() => handleVibhagSelect(vibhag)}
                                                >
                                                        <Text>{vibhag}</Text>
                                                        {selectedVibhag === vibhag && (
                                                                <Ionicons name="checkmark" size={20} color="green" />
                                                        )}
                                                </TouchableOpacity>
                                        ))}
                                </View>
                        )}

                        <TouchableOpacity
                                style={[
                                        styles.submitButton,
                                        (!selectedVillage || !selectedBhag || !selectedVibhag) && styles.submitButtonDisabled
                                ]}
                                onPress={handleSubmit}
                                disabled={!selectedVillage || !selectedBhag || !selectedVibhag}
                        >
                                <Text style={styles.submitButtonText}>पुढे जा</Text>
                        </TouchableOpacity>
                </SafeAreaView>
        );
};

// Add these new styles to your existing StyleSheet
const styles = StyleSheet.create({
        vibhagLabel: {
                padding: 16,
                fontSize: 16,
                fontWeight: '600',
                color: '#000',
                borderBottomWidth: 1,
                borderBottomColor: '#eee'
        },
        vibhagItem: {
                padding: 16,
                borderBottomWidth: 1,
                borderBottomColor: '#f0f0f0',
                flexDirection: 'row',
                justifyContent: 'space-between',
                alignItems: 'center'
        },
        vibhagItemSelected: {
                backgroundColor: '#f0f8ff'
        },
        container: {
                flex: 1,
                backgroundColor: '#f5f5f5',
        },
        header: {
                flexDirection: 'row',
                alignItems: 'center',
                padding: 16,
                backgroundColor: '#fff',
        },
        headerTitle: {
                fontSize: 18,
                fontWeight: '600',
                marginLeft: 16,
                color: '#000',
        },
        content: {
                flex: 1,
                padding: 16,
        },
        profileSection: {
                flexDirection: 'row',
                alignItems: 'center',
                marginBottom: 20,
        },
        profileImage: {
                width: 60,
                height: 60,
                borderRadius: 30,
                marginRight: 16,
        },
        profileName: {
                fontSize: 18,
                fontWeight: '600',
                color: '#000',
        },
        profileRole: {
                fontSize: 14,
                color: '#666',
        },
        statsContainer: {
                flexDirection: 'row',
                justifyContent: 'space-between',
                marginBottom: 16,
        },
        statCard: {
                backgroundColor: '#fff',
                borderRadius: 8,
                padding: 16,
                alignItems: 'center',
                width: '48%',
                shadowColor: '#000',
                shadowOffset: { width: 0, height: 1 },
                shadowOpacity: 0.1,
                shadowRadius: 2,
                elevation: 2,
        },
        statNumber: {
                fontSize: 24,
                fontWeight: 'bold',
                color: '#000',
                marginBottom: 4,
        },
        statLabel: {
                fontSize: 14,
                color: '#666',
        },
        expandableSection: {
                backgroundColor: '#fff',
                borderRadius: 8,
                marginBottom: 16,
                overflow: 'hidden',
                shadowColor: '#000',
                shadowOffset: { width: 0, height: 1 },
                shadowOpacity: 0.1,
                shadowRadius: 2,
                elevation: 2,
        },
        expandableHeader: {
                flexDirection: 'row',
                justifyContent: 'space-between',
                alignItems: 'center',
                padding: 16,
        },
        expandableTitle: {
                fontSize: 16,
                color: '#000',
        },
        dropdownContent: {
                borderTopWidth: 1,
                borderTopColor: '#eee',
        },
        dropdownItem: {
                padding: 16,
                borderBottomWidth: 1,
                borderBottomColor: '#f0f0f0',
        },
        submitButton: {
                backgroundColor: '#2196F3',
                borderRadius: 8,
                padding: 16,
                alignItems: 'center',
                marginTop: 16,
        },
        submitButtonDisabled: {
                backgroundColor: '#cccccc',
        },
        submitButtonText: {
                color: '#fff',
                fontSize: 16,
                fontWeight: '600',
        },
});

export default DashboardScreen;